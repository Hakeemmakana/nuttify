<%-include("../../views/partials/user/header")%>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout Page</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
           
        }
        
        .container1 {
            display: flex;
            max-width: 1200px;
            margin: 0 auto;
            gap: 20px;
        }
        
        .left-section {
            flex: 2;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            padding: 20px;

        }
        
        .right-section {
            position: sticky;
            top: 0px;
            flex: 1;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            padding: 20px;
            height: fit-content;
        }
        
        .delivery-address {
            padding: 15px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .delivery-address h3 {
            font-size: 14px;
            font-weight: normal;
            margin-bottom: 8px;
        }
        
        .delivery-address p {
            font-size: 14px;
            color: #666;
        }
        
        .home-tag {
            background-color: #f0f8ff;
            color: #0066cc;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            margin-left: 10px;
        }
        
        .change-btn {
            padding: 8px 16px;
            background-color: white;
            border: 1px solid #0066cc;
            color: #0066cc;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .product-item {
            display: flex;
            padding: 20px 0;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .product-image {
            width: 120px;
            height: 120px;
            margin-right: 20px;
        }
        
        .product-image img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        
        .product-details {
            flex: 1;
        }
        
        .product-title {
            font-size: 16px;
            margin-bottom: 8px;
            color: #333;
        }
        
        .product-weight {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
        }
        .product-price {
            font-size: 14px;
            color: #070606;
            margin-bottom:0px;
        }

        
        .out-of-stock {
            color: #ff4d4f;
            font-size: 14px;
            margin-bottom: 10px;
        }
        
        .action-buttons {
            display: flex;
            margin-top: 15px;
        }
        
        .save-btn, .remove-btn {
            background: none;
            border: none;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            margin-right: 15px;
        }
        
        .save-btn {
            color: #333;
        }
        
        .remove-btn {
            color: #333;
            margin-left:30px ;
        }
        
        .price-details {
            border-bottom: 1px solid #e0e0e0;
            padding-bottom: 20px;
        }
        
        .price-details h2 {
            font-size: 18px;
            color: #666;
            margin-bottom: 20px;
        }
        
        .price-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            font-size: 14px;
        }
        
        .price-row.total {
            font-weight: bold;
            font-size: 16px;
            margin-top: 20px;
            border-top: 1px solid #e0e0e0;
            padding-top: 15px;
        }
        
        .green-text {
            color: #00a650;
        }
        
        .savings-message {
            color: #00a650;
            font-size: 14px;
            text-align: center;
            margin: 15px 0;
        }
        
        .place-order-btn {
            width: 100%;
            padding: 12px;
            background-color: #ff6a00;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
        }
        
        .secure-message {
            display: flex;
            align-items: center;
            font-size: 14px;
            color: #666;
            margin-top: 20px;
        }
        
        .secure-message img {
            width: 24px;
            height: 24px;
            margin-right: 10px;
        }
        
        .strike-through {
            text-decoration: line-through;
            color: #999;
            margin-right: 5px;
        }
        
        .info-icon {
            color: #999;
            font-size: 12px;
            margin-left: 5px;
        }
        .imgProduct{
            width: 114px;
             margin-right: 14px;

        }
        .containerCartButton {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .control-btn {
            width: 25px;
            height: 25px;
            border: none;
            border-radius: 50%;
            background-color: #fff;
            font-size: 18px;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            display: flex;
            justify-content: center;
            align-items: center;
            
        }

        .control-btn:hover {
            background-color: #f0f0f0;
        }

        .display {
            width: 30px;
            height: 23px;
            background-color: #fff;
            border: 1px solid #ccc;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 14px;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        a{
            text-decoration:none;   
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

</head>
<body>
    <br>
    <div class="container1">
        <div class="left-section">
            
            <% cart.items.forEach(item=>{ %>
            <div class="product-item">
                <div class="product-imag">
                  <a href="/productDetails?id=<%=item.productId._id%>">  <img class="imgProduct" src="<%=item.productId.productImage[0]%>" alt="Pistachios"></a>
                </div>
                <div class="product-details">
                   <a href="/productDetails?id=<%=item.productId._id%>"> <h3 class="product-title"><%=item.productId.productName%></h3></a>
                   <p class="product-price">₹<%=item.totalPrice%></p>
                    <p class="product-weight"><%=item.productId.varient%></p>
                    <%if(item.productId.stock==0){%>
                    <p class="out-of-stock">Currently out of stock </p>
                    <%}%>
                    <div class="action-buttons">
                        <div class="containerCartButton">
                            <button class="control-btn" onclick="cartRemoveButton(`<%=item.productId._id %>`)" >-</button>
                            <div class="display" id='<%= item.productId._id %>'><%=item.quantity%></div>
                            <button class="control-btn" onclick="cartAddButton(`<%=item.productId._id %>`)">+</button>
                        </div>
                        <button class="remove-btn" onclick="removeCart('<%=item.productId._id%>')">REMOVE</button>
                    </div>
                </div>
            </div>
            <%})%>
           
        </div>
        
        <div class="right-section">
            <div class="price-details">
                <h2>PRICE DETAILS</h2>
                <div class="price-row">
                    <span>Price (<%=cart.items.length%> items)</span>
                    <%
                    let totalAmount=0
                    cart.items.forEach(item=>{
                        totalAmount+=item.totalPrice
                    })
                    %>
                    <span>₹<%=totalAmount%></span>
                </div>
                <div class="price-row">
                    <span>Discount</span>
                    <span class="green-text">0</span>
                </div>
                <!-- <div class="price-row">
                    <span>Coupons for you</span>
                    <span class="green-text">− ₹260</span>
                </div> -->
                <div class="price-row">
                    <span>Delivery Charges</span>
                    <span><span class="strike-through">₹120</span> Free</span>
                </div>
                <!-- <div class="price-row">
                    <span>Secured Packaging Fee</span>
                    <span>₹59</span>
                </div> -->
                <!-- <div class="price-row">
                    <span>Protect Promise Fee <span class="info-icon">ⓘ</span></span>
                    <span>₹59</span>
                </div> -->
                <div class="price-row total">
                    <span>Total Amount</span>
                    <span>₹<%=totalAmount%></span>
                </div>
            </div>
            
            <p class="savings-message">You will save ₹0 on this order</p>
            
            <a href="/checkout"><button class="place-order-btn">PLACE ORDER</button></a>
            
            <div class="secure-message">
                <img src="/users/image/cart/secure.png" alt="Shield icon">
                <span>Safe and Secure Payments.Easy returns.100% Authentic products.</span>
            </div>
        </div>
    </div>

    <script>
      
    function cartAddButton(productId){
            fetch("/addToCart",{
                method:'post',
                headers:{
                    "Content-Type":"application/json"
                },
                body:JSON.stringify({productId,quantity:1})
            })
            .then(Response=>Response.json())
            .then(data=>{

                if(data.success){
                    const quantityDisply = document.getElementById(productId);
            if (quantityDisply) {
                let currentQty = parseInt(quantityDisply.innerText);
                quantityDisply.innerText = currentQty + 1;
            }
                   Swal.fire({
                    position: 'bottom', 
                    icon: 'success',
                    title: data.msg,
                    showConfirmButton: false,
                    timer: 3000,
                    background: '#000',
                    color: '#fff',
                    timerProgressBar: true,
                    toast:true,
                    didOpen: (toast) => {
            toast.addEventListener('mouseenter', Swal.stopTimer)
            toast.addEventListener('mouseleave', Swal.resumeTimer)
        }
                   })
                   
                }else{
                    Swal.fire({
                    position: 'bottom', 
                    icon: 'error',
                    title: data.msg,
                    showConfirmButton: false,
                    timer: 3000,
                    background: '#000',
                    color: '#fff',
                    timerProgressBar: true,
                    toast:true,
                    didOpen: (toast) => {
            toast.addEventListener('mouseenter', Swal.stopTimer)
            toast.addEventListener('mouseleave', Swal.resumeTimer)
        }
                   })
                   
                }

                

            })
            

        }


// ---------------cart remove buttton----------------------

function cartRemoveButton(productId){
            fetch("/removeFromCart",{
                method:'post',
                headers:{
                    "Content-Type":"application/json"
                },
                body:JSON.stringify({productId,quantity:1})
            })
            .then(Response=>Response.json())
            .then(data=>{

                if(data.success){
                    const quantityDisply = document.getElementById(productId);
            if (quantityDisply) {
                let currentQty = parseInt(quantityDisply.innerText);
                quantityDisply.innerText = currentQty - 1;
            }
                   Swal.fire({
                    position: 'bottom', 
                    icon: 'success',
                    title: data.msg,
                    showConfirmButton: false,
                    timer: 3000,
                    background: '#000',
                    color: '#fff',
                    timerProgressBar: true,
                    toast:true,
                    didOpen: (toast) => {
            toast.addEventListener('mouseenter', Swal.stopTimer)
            toast.addEventListener('mouseleave', Swal.resumeTimer)
        }
                   })
                }else{
                    Swal.fire({
                    position: 'bottom', 
                    icon: 'error',
                    title: data.msg,
                    showConfirmButton: false,
                    timer: 3000,
                    background: '#000',
                    color: '#fff',
                    timerProgressBar: true,
                    toast:true,
                    didOpen: (toast) => {
            toast.addEventListener('mouseenter', Swal.stopTimer)
            toast.addEventListener('mouseleave', Swal.resumeTimer)
        }
                   })
                   
                }

                

            })
            

        }




        // ----------------remove product from cart------------------


        function removeCart(productId){
            Swal.fire({
                title: 'Remove Item?',
                text: 'Are you sure you want to remove this item from the cart?',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#3085d6',
                confirmButtonText: 'Yes, remove it!'
            })
            .then((result)=>{
                if(result.isConfirmed){
                    fetch('/removeCart', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ productId })
            })
            .then(response=>response.json())
            .then(data=>{
                if(data.success){
                    Swal.fire({
                    position: 'bottom', 
                    icon: 'success',
                    title: data.msg,
                    showConfirmButton: false,
                    timer: 1500,
                    background: '#000',
                    color: '#fff',
                    timerProgressBar: true,
                    toast:true,
                    didOpen: (toast) => {
            toast.addEventListener('mouseenter', Swal.stopTimer)
            toast.addEventListener('mouseleave', Swal.resumeTimer)
        }
                   }).then(()=>{
                    window.location.reload()
                    })
                }else{
                    Swal.fire({
                    position: 'bottom', 
                    icon: 'error',
                    title: data.msg,
                    showConfirmButton: false,
                    timer: 3000,
                    background: '#000',
                    color: '#fff',
                    timerProgressBar: true,
                    toast:true,
                    didOpen: (toast) => {
            toast.addEventListener('mouseenter', Swal.stopTimer)
            toast.addEventListener('mouseleave', Swal.resumeTimer)
        }
                   })
                }
            })
                }

            })
        }


    </script>
    <%-include("../../views/partials/user/footer")%>
