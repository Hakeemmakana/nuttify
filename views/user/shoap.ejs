
<%-include("../../views/partials/user/header")%>
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dried Fruits & Nuts Shop</title>
  <style>
   
    .containershopping {
      display: flex;
      max-width: 1200px;
      margin: 0 auto;
      gap: 20px;
      margin-top: 8px;
    }
    .sidebar {
      width: 220px;
      background-color: rgb(255, 255, 255);
      padding: 15px;
      border-radius: 5px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .sidebar h3 {
      font-size: 16px;
      margin-bottom: 10px;
      padding-bottom: 5px;
      border-bottom: 1px solid #eee;
    }
    .filter-group {
      margin-bottom: 20px;
    }
    .filter-item {
      display: flex;
      align-items: center;
      margin-bottom: 8px;
    }
    .filter-item input {
      margin-right: 8px;
    }
    .filter-item label {
      font-size: 14px;
    }
    .products {
      flex: 1;
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
    }
    .product-card {
      background-color: white;
      border-radius: 5px;
      overflow: hidden;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      position: relative;
    }
    .product-image {
      height: 180px;
      overflow: hidden;
      background-color: #f5f5f5;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }
    .product-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .product-details {
      padding: 10px;
      border-top: 1px solid #eee;
    }
    .product-title {
      font-size: 14px;
      margin-bottom: 5px;
      font-weight: bold;
    }
    .product-price {
      display: flex;
      align-items: center;
      margin-bottom: 5px;
    }
    .product-price .current-price {
      color: #e74c3c;
      font-weight: bold;
      margin-right: 8px;
    }
    .product-price .original-price {
      color: #95a5a6;
      text-decoration: line-through;
      font-size: 13px;
    }
    .product-rating {
      display: flex;
      align-items: center;
    }
    .stars {
      color: #f39c12;
      margin-right: 5px;
    }
    .review-count {
      font-size: 12px;
      color: #7f8c8d;
    }
    .discount-badge {
      position: absolute;
      top: 10px;
      left: 10px;
      background-color: #e74c3c;
      color: white;
      padding: 3px 8px;
      border-radius: 3px;
      font-size: 12px;
      font-weight: bold;
    }
    .wishlist-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      background-color: white;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 1px 3px rgba(0,0,0,0.2);
    }
    .add-to-cart {
      background-color: #2ecc71;
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 3px;
      cursor: pointer;
      font-size: 12px;
      font-weight: bold;
      margin-top: 5px;
    }
    .price-range-filter {
      margin-bottom: 8px;
    }
    
    .rating-stars {
      color: #f39c12;
      font-size: 14px;
    }
    .rating-empty {
      color: #ddd;
      font-size: 14px;
    }
    .apply-btn {
      background-color: #DB4444;
      color: white;
      border: none;
      padding: 10px;
      width: 100%;
      border-radius: 3px;
      font-weight: bold;
      cursor: pointer;
      margin-top: 10px;
      
    }
    .apply-btn:hover{
        background-color: #830404;
    }
    .wishlist-btn:hover{
        background-color: #696969;
    }
    .out-of-stock{
            color: #cc2e2e;
            font-size: 12px;
            font-weight: 600;
            
    }
    .pagination {
        display: flex;
        justify-content: center;
        align-items: center;
        margin-top: 20px;
        font-size: 14px;
    }
    
    .pagination-info {
        margin-right: 20px;
    }
    
    .pagination-controls {
        display: flex;
    }
    
    .pagination-button {
        width: 30px;
        height: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
        border: 1px solid #ccc;
        margin: 0 2px;
        cursor: pointer;
    }
    
    .pagination-button.active {
        background-color: #2c3e50;
        color: white;
        border-color: #2c3e50;
    }
    a{
      text-decoration: none;
      color: black;
    }
    
  </style>
</head>
<body>
  
  <div class="containershopping">
    <div class="sidebar">
      <form action="/filterProduct" method="get" id="sortForm">
        <input type="hidden" id="searchHidden" value="<%=locals.search%>" name="search">
      <div class="filter-group">
         
        <h3>Sort by</h3>
        <% if(locals.sort=='relevance'){%>
        <div class="filter-item">
          <input type="radio" id="relevance" name="sort" value="relevance" checked>
          <label for="relevance">Relevance</label>
        </div>
        <%} else{ %>
          <div class="filter-item">
            <input type="radio" id="relevance" name="sort" value="relevance">
            <label for="relevance">Relevance</label>
          </div>
          <%}%>
         <% if(locals.sort=='price-low-high'){%>
        <div class="filter-item">
          <input type="radio" id="price-low-high" name="sort" value="price-low-high" checked>
          <label for="price-low-high">Price Low - High</label>
        </div>
        <%} else{ %>
          <div class="filter-item">
            <input type="radio" id="price-low-high" name="sort" value="price-low-high">
            <label for="price-low-high">Price Low - High</label>
          </div>
          <%}%>
        <% if(locals.sort=='price-high-low'){%>
        <div class="filter-item">
          <input type="radio" id="price-high-low" name="sort" value="price-high-low" checked>
          <label for="price-high-low">Price High - Low</label>
        </div>
        <%} else{ %>
          <div class="filter-item">
            <input type="radio" id="price-high-low" name="sort" value="price-high-low">
            <label for="price-high-low">Price High - Low</label>
          </div>
          <%}%>
        <!-- <div class="filter-item">
          <input type="radio" id="rating" name="sort">
          <label for="rating">Rating</label>
        </div> -->
      </div>

      <div class="filter-group">
        <h3>Categories</h3>
        <input type="hidden" id="selectedCategory" value="<%=locals.selectedCategory%>">
        <%for(let i=0;i<category.length;i++) {%>
          
            <div class="filter-item">
              <input type="checkbox" id="<%=category[i]._id%>"  name="category"  value="<%=category[i]._id%>" >
              <label for="dates"><%=category[i].name%></label>
            </div>
           
        <%}%>
        <!-- <div class="filter-item">
          <input type="checkbox" id="dry-fruits"  checked>
          <label for="dry-fruits">Dry Fruits</label>
        </div>
        <div class="filter-item">
          <input type="checkbox" id="raisins"  checked>
          <label for="raisins">Raisins</label>
        </div>
        <div class="filter-item">
          <input type="checkbox" id="nuts" checked>
          <label for="nuts">Nuts</label>
        </div>
        <div class="filter-item">
          <input type="checkbox" id="seeds"  checked>
          <label for="seeds">Seeds</label>
        </div>
        <div class="filter-item">
          <input type="checkbox" id="spices" checked>
          <label for="spices">Spices</label>
        </div>
        <div class="filter-item">
          <input type="checkbox" id="chocolates" checked>
          <label for="chocolates">Chocolates</label>
        </div> -->
      </div>
      <div class="filter-group">
        <h3>Price Range</h3>
   
    <input type="hidden" value="<%=locals.priceRanges%>" id="pricerange">
        <div class="filter-item">
          <input name="price" type="checkbox" id="range1" value="0-100" >
          <label for="range1">0 - 100</label>
        </div>
       
         
          
        <div class="filter-item">
          <input  name="price" type="checkbox" id="range2" value="101-250" >
          <label for="range2">101 - 250</label>
        </div>
        <div class="filter-item">
          <input name="price" type="checkbox" id="range3" value="251-500" >
          <label for="range3">251 - 500</label>
        </div>
        <div class="filter-item">
          <input type="checkbox" id="range4" name="price" value="501-1000">
          <label for="range4">501 - 1000</label>
        </div>
        <div class="filter-item">
          <input type="checkbox" id="range5" name="price" value="1001-1500">
          <label for="range5">1001 - 1500</label>
        </div>
        <div class="filter-item">
          <input type="checkbox" id="range6" name="price" value="2000" >
          <label for="range6">Above 2000</label>
        </div>
        
      </div>

      <!-- <div class="filter-group">
        <h3>Rating</h3>
        <div class="filter-item">
          <input type="checkbox" id="rating5" checked>
          <label for="rating5">
            <span class="rating-stars">★★★★★</span>
          </label>
        </div>
        <div class="filter-item">
          <input type="checkbox" id="rating4" checked>
          <label for="rating4">
            <span class="rating-stars">★★★★</span><span class="rating-empty">★</span>
          </label>
        </div>
        <div class="filter-item">
          <input type="checkbox" id="rating3" checked>
          <label for="rating3">
            <span class="rating-stars">★★★</span><span class="rating-empty">★★</span>
          </label>
        </div>
        <div class="filter-item">
            <input type="checkbox" id="rating2" checked>
            <label for="rating3">
              <span class="rating-stars">★★</span><span class="rating-empty">★★★</span>
            </label>
          </div>
          <div class="filter-item">
            <input type="checkbox" id="rating1" checked>
            <label for="rating3">
              <span class="rating-stars">★</span><span class="rating-empty">★★★★</span>
            </label>
          </div>
      </div> -->
      
      <button type="submit"  class="apply-btn">APPLY</button>
    </form>
    </div>
    <div class="products">
      <!-- Product 1 -->
      <%products.forEach(products=>{%>
      <div class="product-card">
        <a href="/productDetails?id=<%=products._id%>">
        <div class="product-image">
          <img src="<%=products.productImage[0]%>" alt="Papaya Dry">
          <span class="discount-badge">25% OFF</span>
        </a>
        <%if(wishlistProductIds.includes(products._id.toString())){%>
          <a href="" onclick=" removeFromWishlist(`<%=products._id%>`)"><div class="wishlist-btn"><i class="bi bi-heart"  style="color: red; " ></i></div></a>
          <%}else{%>
            <a href="" onclick=" addToWishlist(`<%=products._id%>`)"><div class="wishlist-btn"><i class="bi bi-heart"></i></div></a>
            <%}%>
        </div>
        <div class="product-details">
          <h3 class="product-title"><%=products.productName%></h3>
          <div class="product-price">
            <span class="current-price"><%=products.regularPrice%></span>
            <span class="original-price">₹1580</span>
          </div>
            <%if(products.stock==0){%>
              
             <div class="out-of-stock">Out Of Stock</div>
              <%}%>
          <div class="product-rating">
            <span class="stars">★★★★★</span>
            <span class="review-count">(75)</span>
          </div>
          <button onclick="cartAddButton('<%=products._id%>')" class="add-to-cart">Add to Cart</button>
        </div>
      </div>
        <%})%>
        
       </div>
       
  </div>
  <div class="pagination">
    <div class="pagination-info"><%=startItem%>- <%=endItem%>of <%=totalProducts%></div>
    <div class="pagination-controls">
        <div class="pagination-button">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M15 18l-6-6 6-6" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        </div>
        <%for(let i=1;i<=totalPages;i++){%>
            <%if(i==currentPage){%>
            <a class="page" href="/filterProduct?page=<%=i%>&<%= locals.paginationCategory  %>&search=<%= locals.search  %>&<%= locals.paginationPriceRange  %>&sort=<%=locals.sort%>"><div class="pagination-button active"><%=i%></div></a>
                    <%} else {%>
            <a class="page" href="/filterProduct?page=<%=i%>&<%= locals.paginationCategory  %>&search=<%= locals.search  %>&<%= locals.paginationPriceRange  %>&sort=<%=locals.sort%>"><div class="pagination-button "><%=i%></div></a>
        <%}}%>
        <div class="pagination-button">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M9 18l6-6-6-6" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        </div>
    </div>
</div>
  <%-include("../../views/partials/user/footer")%>

  <script>
//     function getSelectedFilters() {
//     let selectedFilters = {
//         categories: [],
//         priceRange: [],
//         sortBy: "",
//     };

//     // Get selected categories
//     document.querySelectorAll('input[name="category"]:checked').forEach((checkbox) => {
//         selectedFilters.categories.push(checkbox.value);
//     });

//     // Get selected price range
//     document.querySelectorAll('input[name="price"]:checked').forEach((checkbox) => {
//         selectedFilters.priceRange.push(checkbox.value);
//     });

//     // Get selected sort option
//     let sortBy = document.querySelector('input[name="sort"]:checked');
//     if (sortBy) {
//         selectedFilters.sortBy = sortBy.value;
//     }

//     return selectedFilters;
// }

// function sendFiltersToBackend() {
//     let filters = getSelectedFilters();

//     fetch("/filterProduct", {
//         method: "get",
//         headers: {
//             "Content-Type": "application/json",
//         },
//         body: JSON.stringify(filters),
//     })
//     .then(response => response.json())
//     .then(data => {
//         console.log("Backend Response:", data);
//         const container = document,getElementbyID('dkdl')

        
//         data.products.forEach(product => {
//           sear;sera
//           namfffe:name
//           container.innnerHTML += `
//           <div class="product-card">
//         <div class="product-image">
//           <img src="/api/placeholder/300/300" alt="Pineapple Dry">
//           <span class="discount-badge">40% OFF</span>
//           <div class="wishlist-btn">♡</div>
//         </div>
//         <div class="product-details">
//           <h3 class="product-title">${product.name}</h3>
//           <div class="product-price">
//             <span class="current-price">₹695</span>
//             <span class="original-price">₹1150</span>
//           </div>
//           <div class="product-rating">
//             <span class="stars">★★★★★</span>
//             <span class="review-count">(88)</span>
//           </div>
//         </div>
//       </div>
//           `
//         })
//     })
//     .catch(error => console.error("Error:", error));
// }


document.addEventListener('DOMContentLoaded', function() {
        const priceRanges = document.getElementById("pricerange").value
        
       
        if(priceRanges.includes("0-100")){
            document.getElementById("range1").checked = true;
        }
        if(priceRanges.includes("101-250")){
            document.getElementById("range2").checked = true;
        }
        if(priceRanges.includes("251-500")){
            document.getElementById("range3").checked = true;
        }
        if(priceRanges.includes("501-1000")){
            document.getElementById("range4").checked = true;
        }
        if(priceRanges.includes("1001-1500")){
            document.getElementById("range5").checked = true;
        }
        if(priceRanges.includes("2000")){
            document.getElementById("range6").checked = true;
        }

    
        
// ----------------------category------------------------------------
const selectedCategory = document.getElementById("selectedCategory").value
console.log("dddd",selectedCategory)


        document.querySelectorAll('input[name="category"]').forEach((category)=>{
          if(selectedCategory.includes(category.value)){
            console.log(category.value)
            category.checked=true
          }
        })

       
    });

   const searchHidden= document.getElementById("searchHidden")
   const partialSearch=document.getElementById("partialSearch")
    
    partialSearch.addEventListener("input",function (){
      searchHidden.value=partialSearch.value
    })

    document.getElementById("partialSearchButton").addEventListener("click",function(){
      document.getElementById("sortForm").submit()
    })

    partialSearch.addEventListener("keydown",function(e){
      if(e.key==="Enter"){
        e.preventDefault()
        document.getElementById("sortForm").submit()
      }
    })

const currentPageUrl=window.location.href
    function addToWishlist(productId){
      fetch('/addToWishlist',{
        method:'POST',
        headers:{
          'Content-Type':'application/json'
        },
        body:JSON.stringify({productId:productId,currentPageUrl:currentPageUrl})
      })
        .then(response=>response.json())
        .then(data=>{
          console.log("=======")
          console.log(data)
        })
      .catch(error=>console.log(error))
    }
    function removeFromWishlist(productId){
      fetch('/removeFromWishlist',{
        method:'POST',
        headers:{
          'Content-Type':'application/json'
        },
        body:JSON.stringify({productId:productId,currentPageUrl:currentPageUrl})
      })
        .then(response=>response.json())
        .then(data=>{
          console.log("=======")
          console.log(data)
        })
      .catch(error=>console.log(error))
    }




    function cartAddButton(productId){
            
            fetch("/addToCart",{
                method:'post',
                headers:{
                    "Content-Type":"application/json"
                },
                body:JSON.stringify({productId,quantity:1})
            })
            .then(Response=>Response.json())
            .then(data=>{
                console.log(data)
                if(data.success){
                   Swal.fire({
                    position: 'bottom', 
                    icon: 'success',
                    title: data.msg,
                    showConfirmButton: false,
                    timer: 3000,
                    background: '#000',
                    color: '#fff',
                    timerProgressBar: true,
                    toast:true,
                    didOpen: (toast) => {
            toast.addEventListener('mouseenter', Swal.stopTimer)
            toast.addEventListener('mouseleave', Swal.resumeTimer)
        }
                   })
                }else{
                    Swal.fire({
                    position: 'bottom', 
                    icon: 'error',
                    title: data.msg,
                    showConfirmButton: false,
                    timer: 3000,
                    background: '#000',
                    color: '#fff',
                    timerProgressBar: true,
                    toast:true,
                    didOpen: (toast) => {
            toast.addEventListener('mouseenter', Swal.stopTimer)
            toast.addEventListener('mouseleave', Swal.resumeTimer)
        }
                   })
                }
            })
            

        }
</script>

  
</body>
</html>